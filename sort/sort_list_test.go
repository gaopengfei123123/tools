package sort

import (
	"github.com/astaxie/beego/logs"
	"github.com/gaopengfei123123/tools/convert"
	"github.com/gaopengfei123123/tools/debug"
	"testing"
)

// 二维数组排序, 二维对象
func TestSortedList_Sorted(t *testing.T) {
	js := `[{"employee":{"clue_cnt":7,"history_in_class_count":7,"quit_people_count":0,"in_class_count":7,"monitor_friend_count":5,"order_count":4,"not_pay_order_count":0,"deposit_order_count":0,"balance_order_count":0,"today_order_nums":4,"during_order_nums":0,"income":198000,"gmv":198000,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"id":43,"name":"胡靖林","order_add_friend_count":0,"in_class_add_friend_count":5,"history_in_class_add_friend_count":1,"days":{"D1":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-13","in_class_add_friend_count":5,"history_in_class_add_friend_count":1},"D10":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-22","in_class_add_friend_count":5,"history_in_class_add_friend_count":1},"D11":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-23","in_class_add_friend_count":5,"history_in_class_add_friend_count":1},"D12":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-24","in_class_add_friend_count":5,"history_in_class_add_friend_count":1},"D13":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-25","in_class_add_friend_count":5,"history_in_class_add_friend_count":1},"D14":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-26","in_class_add_friend_count":5,"history_in_class_add_friend_count":1},"D15":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-27","in_class_add_friend_count":5,"history_in_class_add_friend_count":1},"D16":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-28","in_class_add_friend_count":5,"history_in_class_add_friend_count":1},"D17":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-29","in_class_add_friend_count":5,"history_in_class_add_friend_count":1},"D18":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-30","in_class_add_friend_count":5,"history_in_class_add_friend_count":1},"D19":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-07-01","in_class_add_friend_count":5,"history_in_class_add_friend_count":1},"D2":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-14","in_class_add_friend_count":5,"history_in_class_add_friend_count":1},"D3":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-15","in_class_add_friend_count":5,"history_in_class_add_friend_count":1},"D4":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-16","in_class_add_friend_count":5,"history_in_class_add_friend_count":1},"D5":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-17","in_class_add_friend_count":5,"history_in_class_add_friend_count":1},"D6":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-18","in_class_add_friend_count":5,"history_in_class_add_friend_count":1},"D7":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-19","in_class_add_friend_count":5,"history_in_class_add_friend_count":1},"D8":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-20","in_class_add_friend_count":5,"history_in_class_add_friend_count":1},"D9":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-21","in_class_add_friend_count":5,"history_in_class_add_friend_count":1}}},"groups":[{"clue_cnt":6,"history_in_class_count":6,"quit_people_count":0,"in_class_count":6,"monitor_friend_count":7,"order_count":4,"not_pay_order_count":0,"deposit_order_count":0,"balance_order_count":0,"today_order_nums":4,"during_order_nums":0,"income":200000,"gmv":200000,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"id":188259,"name":"0650","order_add_friend_count":0,"in_class_add_friend_count":7,"history_in_class_add_friend_count":1,"days":{"D1":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-13","in_class_add_friend_count":7,"history_in_class_add_friend_count":1},"D10":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-22","in_class_add_friend_count":7,"history_in_class_add_friend_count":1},"D11":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-23","in_class_add_friend_count":7,"history_in_class_add_friend_count":1},"D12":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-24","in_class_add_friend_count":7,"history_in_class_add_friend_count":1},"D13":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-25","in_class_add_friend_count":7,"history_in_class_add_friend_count":1},"D14":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-26","in_class_add_friend_count":7,"history_in_class_add_friend_count":1},"D15":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-27","in_class_add_friend_count":7,"history_in_class_add_friend_count":1},"D16":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-28","in_class_add_friend_count":7,"history_in_class_add_friend_count":1},"D17":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-29","in_class_add_friend_count":7,"history_in_class_add_friend_count":1},"D18":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-30","in_class_add_friend_count":7,"history_in_class_add_friend_count":1},"D19":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-07-01","in_class_add_friend_count":7,"history_in_class_add_friend_count":1},"D2":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-14","in_class_add_friend_count":7,"history_in_class_add_friend_count":1},"D3":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-15","in_class_add_friend_count":7,"history_in_class_add_friend_count":1},"D4":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-16","in_class_add_friend_count":7,"history_in_class_add_friend_count":1},"D5":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-17","in_class_add_friend_count":7,"history_in_class_add_friend_count":1},"D6":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-18","in_class_add_friend_count":7,"history_in_class_add_friend_count":1},"D7":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-19","in_class_add_friend_count":7,"history_in_class_add_friend_count":1},"D8":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-20","in_class_add_friend_count":7,"history_in_class_add_friend_count":1},"D9":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-21","in_class_add_friend_count":7,"history_in_class_add_friend_count":1}}}]},{"employee":{"clue_cnt":4,"history_in_class_count":4,"quit_people_count":0,"in_class_count":4,"monitor_friend_count":3,"order_count":3,"not_pay_order_count":0,"deposit_order_count":0,"balance_order_count":0,"today_order_nums":3,"during_order_nums":0,"income":150000,"gmv":150000,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"id":56,"name":"白浩","order_add_friend_count":0,"in_class_add_friend_count":3,"history_in_class_add_friend_count":1,"days":{"D1":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-13","in_class_add_friend_count":3,"history_in_class_add_friend_count":1},"D10":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-22","in_class_add_friend_count":3,"history_in_class_add_friend_count":1},"D11":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-23","in_class_add_friend_count":3,"history_in_class_add_friend_count":1},"D12":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-24","in_class_add_friend_count":3,"history_in_class_add_friend_count":1},"D13":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-25","in_class_add_friend_count":3,"history_in_class_add_friend_count":1},"D14":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-26","in_class_add_friend_count":3,"history_in_class_add_friend_count":1},"D15":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-27","in_class_add_friend_count":3,"history_in_class_add_friend_count":1},"D16":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-28","in_class_add_friend_count":3,"history_in_class_add_friend_count":1},"D17":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-29","in_class_add_friend_count":3,"history_in_class_add_friend_count":1},"D18":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-30","in_class_add_friend_count":3,"history_in_class_add_friend_count":1},"D19":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-07-01","in_class_add_friend_count":3,"history_in_class_add_friend_count":1},"D2":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-14","in_class_add_friend_count":3,"history_in_class_add_friend_count":1},"D3":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-15","in_class_add_friend_count":3,"history_in_class_add_friend_count":1},"D4":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-16","in_class_add_friend_count":3,"history_in_class_add_friend_count":1},"D5":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-17","in_class_add_friend_count":3,"history_in_class_add_friend_count":1},"D6":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-18","in_class_add_friend_count":3,"history_in_class_add_friend_count":1},"D7":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-19","in_class_add_friend_count":3,"history_in_class_add_friend_count":1},"D8":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-20","in_class_add_friend_count":3,"history_in_class_add_friend_count":1},"D9":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-21","in_class_add_friend_count":3,"history_in_class_add_friend_count":1}}}},{"employee":{"clue_cnt":1,"history_in_class_count":1,"quit_people_count":1,"in_class_count":0,"monitor_friend_count":0,"order_count":0,"not_pay_order_count":0,"deposit_order_count":0,"balance_order_count":0,"today_order_nums":0,"during_order_nums":0,"income":0,"gmv":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"id":159,"name":"任海洋","order_add_friend_count":0,"in_class_add_friend_count":0,"history_in_class_add_friend_count":0,"days":{"D1":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-13","in_class_add_friend_count":0,"history_in_class_add_friend_count":0},"D10":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-22","in_class_add_friend_count":0,"history_in_class_add_friend_count":0},"D11":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-23","in_class_add_friend_count":0,"history_in_class_add_friend_count":0},"D12":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-24","in_class_add_friend_count":0,"history_in_class_add_friend_count":0},"D13":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-25","in_class_add_friend_count":0,"history_in_class_add_friend_count":0},"D14":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-26","in_class_add_friend_count":0,"history_in_class_add_friend_count":0},"D15":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-27","in_class_add_friend_count":0,"history_in_class_add_friend_count":0},"D16":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-28","in_class_add_friend_count":0,"history_in_class_add_friend_count":0},"D17":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-29","in_class_add_friend_count":0,"history_in_class_add_friend_count":0},"D18":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-30","in_class_add_friend_count":0,"history_in_class_add_friend_count":0},"D19":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-07-01","in_class_add_friend_count":0,"history_in_class_add_friend_count":0},"D2":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-14","in_class_add_friend_count":0,"history_in_class_add_friend_count":0},"D3":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-15","in_class_add_friend_count":0,"history_in_class_add_friend_count":0},"D4":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-16","in_class_add_friend_count":0,"history_in_class_add_friend_count":0},"D5":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-17","in_class_add_friend_count":0,"history_in_class_add_friend_count":0},"D6":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-18","in_class_add_friend_count":0,"history_in_class_add_friend_count":0},"D7":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-19","in_class_add_friend_count":0,"history_in_class_add_friend_count":0},"D8":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-20","in_class_add_friend_count":0,"history_in_class_add_friend_count":0},"D9":{"clue_cnt":0,"learning_live_count":0,"learning_live_count_in60":0,"learning_work_count":0,"day":0,"date":"2023-06-21","in_class_add_friend_count":0,"history_in_class_add_friend_count":0}}}}]`

	tmpList := make([]map[string]interface{}, 0, 1)
	_ = convert.JSONDecode([]byte(js), &tmpList)

	sortedList := new(SortedList)
	sortedList.LoadData(tmpList)
	err := sortedList.Sorted("employee.gmv", true).DecodeList(&tmpList)
	tmp1 := tmpList[0]["employee"].(map[string]interface{})
	logs.Info("sort desc first: %v, err: %v", tmp1["gmv"], err)

	err = sortedList.Sorted("employee.gmv", false).DecodeList(&tmpList)
	tmp1 = tmpList[0]["employee"].(map[string]interface{})
	logs.Info("sort asc first: %v, err: %v", tmp1["gmv"], err)
}

// 分组排序
func TestSortedList_GroupSorted(t *testing.T) {
	js := `[{"channel_key":"channel_wx","channel_type":"channel_2_vk","intention_cnt":20,"clue_cnt":15,"in_room_cnt":10,"in_room_rate":"66.67%","in_room_rate_value":0.6666666666666666,"order_cnt":7,"order_in_group_cnt":0,"transfer_rate":"46.67%","transfer_rate_value":0.4666666666666667,"in_room_transfer_rate":"0.00%","gmv":100},{"channel_key":"channel_feed","channel_type":"channel_2_app","intention_cnt":21,"clue_cnt":16,"in_room_cnt":11,"in_room_rate":"68.75%","in_room_rate_value":0.6875,"order_cnt":8,"order_in_group_cnt":0,"transfer_rate":"50.00%","transfer_rate_value":0.5,"in_room_transfer_rate":"0.00%","gmv":101},{"channel_key":"channel_group","channel_type":"channel_2_vk","intention_cnt":22,"clue_cnt":17,"in_room_cnt":12,"in_room_rate":"70.59%","in_room_rate_value":0.7058823529411765,"order_cnt":9,"order_in_group_cnt":0,"transfer_rate":"52.94%","transfer_rate_value":0.5294117647058824,"in_room_transfer_rate":"0.00%","gmv":102},{"channel_key":"channel_wx","channel_type":"channel_2_app","intention_cnt":23,"clue_cnt":18,"in_room_cnt":13,"in_room_rate":"72.22%","in_room_rate_value":0.7222222222222222,"order_cnt":10,"order_in_group_cnt":0,"transfer_rate":"55.56%","transfer_rate_value":0.5555555555555556,"in_room_transfer_rate":"0.00%","gmv":103},{"channel_key":"channel_feed","channel_type":"channel_2_vk","intention_cnt":24,"clue_cnt":19,"in_room_cnt":14,"in_room_rate":"73.68%","in_room_rate_value":0.7368421052631579,"order_cnt":11,"order_in_group_cnt":0,"transfer_rate":"57.89%","transfer_rate_value":0.5789473684210527,"in_room_transfer_rate":"0.00%","gmv":104},{"channel_key":"channel_group","channel_type":"channel_2_app","intention_cnt":25,"clue_cnt":20,"in_room_cnt":15,"in_room_rate":"75.00%","in_room_rate_value":0.75,"order_cnt":12,"order_in_group_cnt":0,"transfer_rate":"60.00%","transfer_rate_value":0.6,"in_room_transfer_rate":"0.00%","gmv":105},{"channel_key":"channel_wx","channel_type":"channel_2_vk","intention_cnt":26,"clue_cnt":21,"in_room_cnt":16,"in_room_rate":"76.19%","in_room_rate_value":0.7619047619047619,"order_cnt":13,"order_in_group_cnt":0,"transfer_rate":"61.90%","transfer_rate_value":0.6190476190476191,"in_room_transfer_rate":"0.00%","gmv":106},{"channel_key":"channel_feed","channel_type":"channel_2_app","intention_cnt":27,"clue_cnt":22,"in_room_cnt":17,"in_room_rate":"77.27%","in_room_rate_value":0.7727272727272727,"order_cnt":14,"order_in_group_cnt":0,"transfer_rate":"63.64%","transfer_rate_value":0.6363636363636364,"in_room_transfer_rate":"0.00%","gmv":107},{"channel_key":"channel_group","channel_type":"channel_2_vk","intention_cnt":28,"clue_cnt":23,"in_room_cnt":18,"in_room_rate":"78.26%","in_room_rate_value":0.782608695652174,"order_cnt":15,"order_in_group_cnt":0,"transfer_rate":"65.22%","transfer_rate_value":0.6521739130434783,"in_room_transfer_rate":"0.00%","gmv":108},{"channel_key":"channel_wx","channel_type":"channel_2_app","intention_cnt":29,"clue_cnt":24,"in_room_cnt":19,"in_room_rate":"79.17%","in_room_rate_value":0.7916666666666666,"order_cnt":16,"order_in_group_cnt":0,"transfer_rate":"66.67%","transfer_rate_value":0.6666666666666666,"in_room_transfer_rate":"0.00%","gmv":109}]`
	tmpList := make([]map[string]interface{}, 0, 1)
	_ = convert.JSONDecode([]byte(js), &tmpList)

	sortedList := new(SortedList)
	sortedList.LoadData(tmpList)

	err := sortedList.GroupSorted("channel_key", "clue_cnt", true).DecodeList(&tmpList)

	debug.PrintJson("tmpList", tmpList)
	logs.Info("Err: %v", err)
}
